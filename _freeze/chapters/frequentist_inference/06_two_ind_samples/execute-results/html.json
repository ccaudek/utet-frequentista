{
  "hash": "27d6075e3df1dae10f08ce737637e0e5",
  "result": {
    "engine": "knitr",
    "markdown": "# Test t di Student per campioni indipendenti\n\n::: callout-important\n## In questo capitolo imparerai a\n\n- eseguire un test di ipotesi frequentista per confrontare le medie di due campioni indipendenti, assumendo l'ipotesi nulla;\n- capire i limiti del test frequentista $t$ di Student.\n:::\n\n::: callout-tip\n## Prerequisiti\n\n- Leggere *Bayesian estimation supersedes the t test* [@kruschke2013bayesian].\n:::\n\n::: callout-caution\n## Preparazione del Notebook\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhere::here(\"code\", \"_common.R\") |> \n  source()\n\n# Load packages\nif (!requireNamespace(\"pacman\")) install.packages(\"pacman\")\npacman::p_load(mice)\n```\n:::\n\n:::\n\n\n## Introduzione\n\nQuesto capitolo è dedicato al [test t di Student](https://www.scientificamerican.com/article/how-the-guinness-brewery-invented-the-most-important-statistical-method-in/) per campioni indipendenti, uno dei test statistici più utilizzati nella pratica frequentista. Il test t di Student è un metodo che permette di confrontare le medie di due gruppi diversi (o \"campioni\") e determinare se la differenza osservata tra le medie sia statisticamente significativa o se possa essere attribuita a semplice casualità.\n\nIl test è particolarmente utile quando si ha accesso solo a piccoli campioni provenienti da popolazioni sconosciute, ma è importante comprendere bene i suoi principi fondamentali e limiti prima di applicarlo.\n\n## Applicazioni del Test t di Student\n\nIl test t di Student per campioni indipendenti serve per rispondere alla domanda: \"Le medie di due gruppi sono significativamente diverse?\" Per esempio, potremmo voler sapere se ci sono differenze significative nel peso medio tra uomini e donne.\n\n## Assunzioni Principali\n\nPrima di procedere con il test, è essenziale assicurarsi che siano valide le seguenti ipotesi:\n\n1. **Indipendenza**: Le osservazioni nei due campioni devono essere indipendenti.\n2. **Normalità**: I dati nei due campioni provengono da popolazioni distribuite normalmente.\n3. **Uguaglianza delle Varianze (Omoschedasticità)**: Le varianze delle due popolazioni da cui provengono i campioni sono uguali.\n\nSe queste condizioni non sono soddisfatte, potrebbe essere necessario considerare alternative come il **test di Welch**, che non richiede l'uguaglianza delle varianze.\n\n## Passaggi del Test t di Student\n\nEcco una panoramica dei passaggi chiave:\n\n1. **Calcolare la Differenza tra le Medie**: Si calcola la differenza tra le medie dei due campioni.\n   \n   $$\n   \\bar{x}_1 - \\bar{x}_2\n   $$\n   \n   dove $\\bar{x}_1$ e $\\bar{x}_2$ sono le medie dei due campioni.\n\n2. **Stimare la Deviazione Standard Combinata**: Se assumiamo che le varianze siano uguali (omoschedasticità), possiamo usare una stima combinata della deviazione standard, chiamata **deviazione standard pooled** $s_p$:\n\n   $$\n   s_p = \\sqrt{\\frac{(n_1 - 1)s_1^2 + (n_2 - 1)s_2^2}{n_1 + n_2 - 2}}\n   $$\n\n   dove $n_1$ e $n_2$ sono le dimensioni dei campioni, e $s_1^2$ e $s_2^2$ sono le varianze campionarie.\n\n3. **Calcolare la Statistica t**: La statistica t viene calcolata usando la formula seguente:\n\n   $$\n   t = \\frac{(\\bar{x}_1 - \\bar{x}_2)}{s_p \\sqrt{\\left(\\frac{1}{n_1} + \\frac{1}{n_2}\\right)}}\n   $$\n\n4. **Determinare i Gradi di Libertà**: I gradi di libertà ($df$) sono calcolati come:\n\n   $$\n   df = n_1 + n_2 - 2\n   $$\n\n5. **Calcolare il Valore-p**: Infine, si confronta la statistica t con la distribuzione t di Student per ottenere il valore-p. Questo valore indica la probabilità di osservare una differenza così estrema tra le medie dei campioni, dato che l'ipotesi nulla è vera.\n\n## Dimostrazione \n\nPer dimostrare come calcolare la varianza della differenza tra due medie campionarie, consideriamo due campioni casuali indipendenti $X_1, X_2, \\dots, X_n$ e $Y_1, Y_2, \\dots, Y_m$, estratti dalla stessa popolazione con media $\\mu$ e varianza $\\sigma^2$. Definiamo $\\bar{X}$ e $\\bar{Y}$ come le medie campionarie di questi due campioni, rispettivamente.\n\nLe medie campionarie $\\bar{X}$ e $\\bar{Y}$ sono date da:\n\n$$\n\\bar{X} = \\frac{1}{n} \\sum_{i=1}^n X_i ,\n$$\n$$\n\\bar{Y} = \\frac{1}{m} \\sum_{j=1}^m Y_j .\n$$\n\nEntrambe le medie campionarie $\\bar{X}$ e $\\bar{Y}$ sono stimatori non distorti della media della popolazione $\\mu$. Le loro varianze sono:\n\n$$\n\\text{Var}(\\bar{X}) = \\frac{\\sigma^2}{n} ,\n$$\n$$\n\\text{Var}(\\bar{Y}) = \\frac{\\sigma^2}{m} .\n$$\n\nSiamo interessati a calcolare la varianza della differenza $\\bar{X} - \\bar{Y}$. Utilizzando le proprietà della varianza per combinazioni lineari di variabili aleatorie indipendenti, otteniamo:\n\n$$\n\\text{Var}(\\bar{X} - \\bar{Y}) = \\text{Var}(\\bar{X}) + \\text{Var}(\\bar{Y}) ,\n$$\n\ndato che i termini incrociati si annullano per l'indipendenza di $\\bar{X}$ e $\\bar{Y}$. Sostituendo le varianze di $\\bar{X}$ e $\\bar{Y}$, abbiamo:\n\n$$\n\\text{Var}(\\bar{X} - \\bar{Y}) = \\frac{\\sigma^2}{n} + \\frac{\\sigma^2}{m} ,\n$$\n$$\n\\text{Var}(\\bar{X} - \\bar{Y}) = \\sigma^2 \\left(\\frac{1}{n} + \\frac{1}{m}\\right) .\n$$\n\nQuindi, la varianza della differenza tra le due medie campionarie è una combinazione delle varianze delle singole medie, ponderate in base alle dimensioni dei campioni corrispondenti.\n\nPer giungere alla formula del test $t$ di Student per due campioni indipendenti, dobbiamo considerare l'incertezza aggiuntiva derivante dal fatto che non conosciamo $\\sigma$. Il modo migliore per stimare $\\sigma$ è utilizzare le due deviazioni standard dei campioni, ponderate per i rispettivi gradi di libertà, come indicato nella formula della deviazione standard *pooled*:\n\n$$\ns_p = \\sqrt{\\frac{(n - 1)s^2_x + (m - 1)s^2_y}{n + m - 2}},\n$$\n\ndove $s_x$ e $s_y$ sono le deviazioni standard dei due campioni, e $n$ e $m$ sono le numerosità dei due campioni.\n\n## Esempio Pratico\n\nSupponiamo di avere due campioni: \n\n- **Donne**: Pesi = [38.9, 61.2, 73.3, 21.8, 63.4, 64.6, 48.4, 48.8, 48.5]\n- **Uomini**: Pesi = [67.8, 60, 63.4, 76, 89.4, 73.3, 67.3, 61.3, 62.4]\n\nCreiamo un DataFrame in R e calcoliamo la statistica t:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nwomen_weight <- c(38.9, 61.2, 73.3, 21.8, 63.4, 64.6, 48.4, 48.8, 48.5)\nmen_weight <- c(67.8, 60, 63.4, 76, 89.4, 73.3, 67.3, 61.3, 62.4)\n\nweight <- c(women_weight, men_weight)\nis_female <- rep(c(1, 0), each = 9)  # 1 = Femmina, 0 = Maschio\n\ndf <- data.frame(is_female = is_female, weight = weight)\n```\n:::\n\n\nPer calcolare manualmente la statistica t:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# Estraiamo i pesi per ogni gruppo\nweight_f <- df$weight[df$is_female == 1]\nweight_m <- df$weight[df$is_female == 0]\n\n# Calcolo della deviazione standard pooled\ns_pool_num <- ((length(weight_f) - 1) * var(weight_f)) + ((length(weight_m) - 1) * var(weight_m))\ns_pool_denom <- length(weight_f) + length(weight_m) - 2\ns_pool <- sqrt(s_pool_num / s_pool_denom)\n\n# Calcolo della statistica t\nt_num <- mean(weight_f) - mean(weight_m)\nt_denom <- s_pool * sqrt(1 / length(weight_f) + 1 / length(weight_m))\nT <- t_num / t_denom\nT\n#> [1] -2.78\n```\n:::\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# Gradi di libertà\ndf_degrees <- length(weight_f) + length(weight_m) - 2\ndf_degrees\n#> [1] 16\n```\n:::\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# Calcolo del valore-p\np_value <- 2 * pt(abs(T), df = df_degrees, lower.tail = FALSE)\nprint(p_value)\n#> [1] 0.0133\n```\n:::\n\n\n\nIn alternativa, possiamo usare la funzione `t.test` di R:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nres <- t.test(weight_f, weight_m, var.equal = TRUE)\nprint(res, digits = 7)\n#> \n#> \tTwo Sample t-test\n#> \n#> data:  weight_f and weight_m\n#> t = -2.7842, df = 16, p-value = 0.01327\n#> alternative hypothesis: true difference in means is not equal to 0\n#> 95 percent confidence interval:\n#>  -29.748019  -4.029759\n#> sample estimates:\n#> mean of x mean of y \n#>  52.10000  68.98889\n```\n:::\n\n\n\n### Interpretazione dei Risultati\n\nIl test t di Student ha generato un valore-p inferiore a 0.05, indicando che la differenza osservata tra i pesi medi delle donne e degli uomini è statisticamente significativa. Questo significa che, con un livello di confidenza del 95%, possiamo rifiutare l'ipotesi nulla secondo cui le medie dei due gruppi sono uguali.\n\nÈ importante ricordare che un basso valore-p suggerisce che la differenza osservata non è dovuta al caso. Tuttavia, ciò non prova automaticamente una relazione causale; piuttosto, apre la strada ad ulteriori indagini sulle cause della differenza.\n\n\n### Riportare i Risultati\n\nQuando si riportano i risultati di un test t, è fondamentale adottare pratiche che favoriscano una comprensione approfondita e accurata dei dati. Di seguito viene presentato un confronto tra due versioni dei risultati: una da evitare, che si basa su un'interpretazione tradizionale della significatività statistica, e una versione migliorata che enfatizza l'intervallo di confidenza e l'ampiezza dell'effetto.\n\n#### Versione da Evitare\n\nLa seguente formulazione segue un approccio tradizionale incentrato sulla \"significatività statistica,\" che è oggi ritenuto inadeguato per una comunicazione efficace dei risultati:\n\n> Abbiamo condotto un test t di Student per confrontare le medie dei due gruppi. I risultati mostrano una differenza significativa tra i pesi medi delle donne e degli uomini (t(16) = -2.78, p-value = 0.01). L'intervallo di confidenza al 95% per la differenza delle medie è [-29.75, -4.03]. L'ampiezza dell'effetto, misurata con Cohen's d, è 1.31, indicando un effetto grande. La potenza statistica del test è stata stimata al 74.4%.\n\nIn questa versione, il focus è eccessivamente concentrato sul valore-p, che può portare a interpretazioni riduttive e distorte dei risultati.\n\n#### Versione Migliorata\n\nEcco invece una versione migliore che mantiene un approccio frequentista, ma sposta l'enfasi sull'intervallo di confidenza e sull'ampiezza dell'effetto, offrendo una descrizione più completa e informativa:\n\n> È stato condotto un test t di Student per confrontare le medie dei due gruppi. La differenza tra i pesi medi delle donne e degli uomini è stata stimata in **-16.89 kg** (intervallo di confidenza al 95%: **[-29.75, -4.03]**), suggerendo che il peso medio degli uomini sia maggiore rispetto a quello delle donne nel campione analizzato. Questo intervallo indica che, con una fiducia del 95%, la differenza reale tra i pesi medi potrebbe variare tra circa -29.75 kg e -4.03 kg.\n>\n> L’ampiezza dell’effetto, misurata con **Cohen’s d = 1.31**, indica una differenza considerevole, equivalente a oltre una deviazione standard. Questo valore suggerisce che la differenza osservata non solo è statisticamente rilevante, ma anche sostanziale dal punto di vista pratico. \n>\n> Inoltre, la potenza del test, considerando la dimensione dell’effetto osservata, è pari al **74.4%**, suggerendo che il test ha una buona capacità di rilevare differenze di questa entità nel campione analizzato. Ciò significa che, se una differenza di tale magnitudine fosse presente nella popolazione, esisterebbe una probabilità superiore al 70% di rilevarla correttamente.\n\nQuesta modalità di reporting fornisce una descrizione più dettagliata ed esplicativa dei risultati, evitando interpretazioni basate esclusivamente sul valore-p e concentrandosi invece sulla grandezza e sull'incertezza della stima. Tale approccio consente una valutazione più equilibrata e informata dei dati, promuovendo una comprensione più approfondita delle implicazioni pratiche e scientifiche dei risultati ottenuti.\n\n\n## Riflessioni Conclusive\n\nIl **test t di Student** è uno strumento statistico ampiamente utilizzato per l'inferenza su una media o per confrontare le medie di due gruppi. È talmente importante che alcuni lo hanno definito [*il metodo statistico più importante nella scienza*](https://www.scientificamerican.com/article/how-the-guinness-brewery-invented-the-most-important-statistical-method-in/). Tuttavia, come osserva [Andrew Gelman](https://statmodeling.stat.columbia.edu/2025/02/10/what-is-the-correct-value-of-x-in-the-sentence-the-t-test-is-the-xth-most-important-statistical-method-in-science/), questa affermazione non va accettata acriticamente. Benché il test t sia semplice ed efficace in molti contesti, presenta notevoli limitazioni che ne riducono l'affidabilità e l'applicabilità quando si affrontano problemi complessi o si desidera una comprensione più approfondita dei dati [@kruschke2013bayesian].\n\n### Limiti del Test t di Student\n\nUno dei principali limiti del test t risiede nell'assunzione che i dati seguano una distribuzione normale (gaussiana). Questa assunzione è spesso violata in pratica, specialmente con campioni piccoli o quando i dati presentano asimmetrie o code pesanti. Inoltre, nel caso di campioni indipendenti, il test richiede l'omogeneità delle varianze, un'altra assunzione frequentemente infondata. Quando queste condizioni non sono soddisfatte, il test può fornire risultati distorti, necessitando di correzioni come quella di Welch per gestire differenze di varianza.\n\nUn ulteriore limite del test t è legato alla sua dipendenza dalla soglia di significatività $\\alpha$, solitamente fissata a 0.05. Questa scelta è arbitraria e può influenzare criticamente le conclusioni. Il test valuta esclusivamente la compatibilità dei dati con l'ipotesi nulla ($H_0$) e fornisce solo un p-value, senza offrire informazioni dirette sulla plausibilità dell'ipotesi alternativa ($H_1$). Ciò significa che un p-value basso non garantisce che $H_1$ sia vera o che i dati supportino tale ipotesi.\n\n### L'Approccio Bayesiano: Una Soluzione Più Potente\n\nIn contrasto con il paradigma frequentista, l'**approccio bayesiano** offre un quadro statistico più flessibile e informativo. Attraverso il teorema di Bayes, è possibile calcolare direttamente la probabilità di un'ipotesi dato l'insieme dei dati osservati. Questo permette di quantificare la forza dell'evidenza a favore di un'ipotesi rispetto alle altre, superando le limitazioni intrinseche del test t.\n\n#### Vantaggi dell'Approccio Bayesiano\n\n1. **Non richiede assunzioni rigide**: A differenza del test t, che si basa su ipotesi restrittive come la normalità e l'omoschedasticità, l'inferenza bayesiana è in grado di gestire modelli più generali e robusti, adattandosi ai dati reali senza doverli forzare in strutture artificiali.\n   \n2. **Incorporazione delle informazioni pregresse**: L'approccio bayesiano permette di integrare conoscenze pregresse attraverso distribuzioni a priori, migliorando la qualità delle stime e consentendo analisi più realistiche. Questo è particolarmente utile in situazioni dove i dati disponibili sono scarsi o rumorosi.\n\n3. **Inferenze più informative**: Al posto di semplici decisioni binarie (\"rifiuto\" o \"non rifiuto\" di $H_0$), il bayesianismo fornisce distribuzioni a posteriori complete, che descrivono l'incertezza sui parametri di interesse. Questo consente inferenze più dettagliate e interpretabili.\n\n4. **Gestione della complessità**: L'approccio bayesiano gestisce in modo naturale modelli complessi e gerarchici, rendendolo ideale per analisi avanzate. Ad esempio, Kruschke (2013) dimostra come tecniche bayesiane possano superare le limitazioni del test t anche in presenza di violazioni delle assunzioni classiche, producendo risultati più stabili e affidabili.\n\n#### Implementazione Pratica\n\nSebbene l'approccio bayesiano richieda una maggiore attenzione nella scelta delle distribuzioni a priori e nella specificazione del modello, l'avvento di software moderni come Stan, PyMC3 e JAGS ha reso l'implementazione di modelli bayesiani sempre più accessibile. Oggi, anche ricercatori con competenze statistiche moderate possono applicare metodi bayesiani per affrontare problemi complessi con maggiore precisione e coerenza.\n\n### Conclusioni\n\nIl test t di Student rimane un valido strumento per analisi rapide e semplici, ma le sue limitazioni diventano evidenti quando si lavora con dati complessi o si cerca una comprensione più profonda delle relazioni sottostanti. L'approccio bayesiano rappresenta un'evoluzione concettuale e metodologica rispetto all'inferenza frequentista tradizionale, offrendo numerosi vantaggi: inferenze più ricche, integrazione di informazioni pregresse, gestione delle violazioni delle assunzioni e produzione di stime più robuste. Per questi motivi, il paradigma bayesiano è sempre più considerato come la scelta preferibile per chi desidera un'analisi statistica solida, flessibile e informativa. \n\nIn ultima analisi, mentre il test t resta un punto di partenza utile, l'adozione dell'approccio bayesiano permette di avanzare verso una comprensione più completa e accurata dei dati.\n\n\n## Informazioni sull'Ambiente di Sviluppo {.unnumbered} \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nsessionInfo()\n#> R version 4.5.1 (2025-06-13)\n#> Platform: aarch64-apple-darwin20\n#> Running under: macOS Sequoia 15.6.1\n#> \n#> Matrix products: default\n#> BLAS:   /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/lib/libRblas.0.dylib \n#> LAPACK: /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.1\n#> \n#> locale:\n#> [1] C/UTF-8/C/C/C/C\n#> \n#> time zone: Europe/Rome\n#> tzcode source: internal\n#> \n#> attached base packages:\n#> [1] stats     graphics  grDevices utils     datasets  methods   base     \n#> \n#> other attached packages:\n#>  [1] mice_3.18.0           pillar_1.11.0         tinytable_0.13.0     \n#>  [4] patchwork_1.3.2       ggdist_3.3.3          tidybayes_3.0.7      \n#>  [7] bayesplot_1.14.0      ggplot2_3.5.2         reliabilitydiag_0.2.1\n#> [10] priorsense_1.1.1      posterior_1.6.1       loo_2.8.0            \n#> [13] rstan_2.32.7          StanHeaders_2.32.10   brms_2.22.0          \n#> [16] Rcpp_1.1.0            sessioninfo_1.2.3     conflicted_1.2.0     \n#> [19] janitor_2.2.1         matrixStats_1.5.0     modelr_0.1.11        \n#> [22] tibble_3.3.0          dplyr_1.1.4           tidyr_1.3.1          \n#> [25] rio_1.2.3             here_1.0.1           \n#> \n#> loaded via a namespace (and not attached):\n#>  [1] Rdpack_2.6.4          gridExtra_2.3         inline_0.3.21        \n#>  [4] sandwich_3.1-1        rlang_1.1.6           magrittr_2.0.3       \n#>  [7] multcomp_1.4-28       snakecase_0.11.1      compiler_4.5.1       \n#> [10] systemfonts_1.2.3     vctrs_0.6.5           stringr_1.5.1        \n#> [13] pkgconfig_2.0.3       shape_1.4.6.1         arrayhelpers_1.1-0   \n#> [16] fastmap_1.2.0         backports_1.5.0       rmarkdown_2.29       \n#> [19] nloptr_2.2.1          ragg_1.5.0            purrr_1.1.0          \n#> [22] jomo_2.7-6            xfun_0.53             glmnet_4.1-10        \n#> [25] cachem_1.1.0          jsonlite_2.0.0        pan_1.9              \n#> [28] broom_1.0.9           parallel_4.5.1        R6_2.6.1             \n#> [31] stringi_1.8.7         RColorBrewer_1.1-3    rpart_4.1.24         \n#> [34] boot_1.3-32           lubridate_1.9.4       estimability_1.5.1   \n#> [37] iterators_1.0.14      knitr_1.50            zoo_1.8-14           \n#> [40] pacman_0.5.1          nnet_7.3-20           Matrix_1.7-4         \n#> [43] splines_4.5.1         timechange_0.3.0      tidyselect_1.2.1     \n#> [46] abind_1.4-8           codetools_0.2-20      curl_7.0.0           \n#> [49] pkgbuild_1.4.8        lattice_0.22-7        withr_3.0.2          \n#> [52] bridgesampling_1.1-2  coda_0.19-4.1         evaluate_1.0.5       \n#> [55] survival_3.8-3        RcppParallel_5.1.11-1 tensorA_0.36.2.1     \n#> [58] checkmate_2.3.3       foreach_1.5.2         stats4_4.5.1         \n#> [61] reformulas_0.4.1      distributional_0.5.0  generics_0.1.4       \n#> [64] rprojroot_2.1.1       rstantools_2.5.0      scales_1.4.0         \n#> [67] minqa_1.2.8           xtable_1.8-4          glue_1.8.0           \n#> [70] emmeans_1.11.2-8      tools_4.5.1           lme4_1.1-37          \n#> [73] mvtnorm_1.3-3         grid_4.5.1            rbibutils_2.3        \n#> [76] QuickJSR_1.8.0        colorspace_2.1-1      nlme_3.1-168         \n#> [79] cli_3.6.5             textshaping_1.0.3     svUnit_1.0.8         \n#> [82] Brobdingnag_1.2-9     V8_7.0.0              gtable_0.3.6         \n#> [85] digest_0.6.37         TH.data_1.1-4         htmlwidgets_1.6.4    \n#> [88] farver_2.1.2          memoise_2.0.1         htmltools_0.5.8.1    \n#> [91] lifecycle_1.0.4       mitml_0.4-5           MASS_7.3-65\n```\n:::\n\n\n## Bibliografia {.unnumbered}\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}